rootContext: {"users": [], "products": []}

steps:
  - type: forEach
    path: .
    as: userId
    parallel: true
    maxConcurrency: 2
    noopMerge: true
    values: [1, 2]
    steps:
      - type: request
        name: Get User
        request:
          url: "https://api.example.com/users/{{ .userId.value }}"
          method: GET
        mergeWithContext:
          name: root
          rule: ".users += [$res]"

  - type: forEach
    path: .
    as: productId
    parallel: true
    maxConcurrency: 2
    noopMerge: true
    values: [101, 102]
    steps:
      - type: request
        name: Get Product
        request:
          url: "https://api.example.com/products/{{ .productId.value }}"
          method: GET
        mergeWithContext:
          name: root
          rule: ".products += [$res]"
